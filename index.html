<script type="module">
  import {
    createThirdwebClient,
    getContract,
  } from "https://esm.sh/thirdweb@4.0.0";
  import { metamask } from "https://esm.sh/thirdweb/wallets";
  import { defineChain } from "https://esm.sh/thirdweb/chains";

  const client = createThirdwebClient({
    clientId: "b2f0efa779d1c21ac55d26906bc544ae",
  });

  const chain = defineChain(56); // BNB Chain
  const tokenAddress = "0xf5d20B8a854A01Cb768fA644BF740EB855cE00cb"; // BCOOK

  let wallet;

  const connectBtn = document.getElementById("connect");
  const claimBtn = document.getElementById("claim");

  console.log("Script loaded. Buttons:", connectBtn, claimBtn);

  connectBtn.onclick = async () => {
    console.log("Connect clicked");
    try {
      const walletInstance = metamask();
      wallet = await walletInstance.connect({
        client,
        chain,
      });

      const address = await wallet.getAddress();
      alert("Connected: " + address);
      claimBtn.style.display = "inline-block";
    } catch (err) {
      console.error("Connect error:", err);
      alert("Wallet connect failed.");
    }
  };

  claimBtn.onclick = async () => {
    console.log("Claim clicked");
    try {
      const contract = await getContract({
        client,
        chain,
        address: tokenAddress,
      });

      const name = await contract.erc20.name();
      alert("Connected to token: " + name);

      // Real claim line (disabled for now):
      // await contract.erc20.claim("10");
      alert("Claim successful (simulated)");
    } catch (err) {
      console.error("Claim error:", err);
      alert("Error claiming token: " + err.message);
    }
  };
</script>
